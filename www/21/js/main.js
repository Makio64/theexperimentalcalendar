// Generated by CoffeeScript 1.4.0
var Bump,HALF_PI,PI,Paper,Pattern,Scene,Shapes,Spring,Sprites,TWO_PI,aspect,atan2,camera,ceil,chance,clock,cos,distance,drag,floor,height,init,max,min,mousedown,mousemove,mouseup,random,renderer,resize,round,scene,sin,sqrt,tan,themes,update,utils,width,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};(function(){var e,t,n,r,i,s,o,u;i=window;u=["ms","moz","webkit","o"];for(s=0,o=u.length;s<o;s++){r=u[s];if(i.requestAnimationFrame)break;i.requestAnimationFrame=i[""+r+"RequestAnimationFrame"];i.cancelAnimationFrame=i[""+r+"CancelAnimationFrame"]||i[""+r+"CancelRequestAnimationFrame"]}if(i.requestAnimationFrame){if(i.cancelAnimationFrame)return;e=i.requestAnimationFrame;t={};i.requestAnimationFrame=function(n){var r;return r=e(function(e){return r in t?delete t[r]:n(e)})};return i.cancelAnimationFrame=function(e){return t[e]=!0}}n=0;i.requestAnimationFrame=function(e){var t;n=Math.max(n+16,t=+(new Date));return i.setTimeout(function(){return e(+(new Date))},n-t)};return i.cancelAnimationFrame=function(e){return clearTimeout(e)}})();PI=Math.PI;TWO_PI=PI*2;HALF_PI=PI/2;min=Math.min;max=Math.max;sin=Math.sin;cos=Math.cos;tan=Math.tan;atan2=Math.atan2;round=Math.round;floor=Math.floor;ceil=Math.ceil;sqrt=Math.sqrt;chance=function(e){return Math.random()<e};random=function(e,t){if(e&&typeof e.length=="number"&&e.length!=null)return e[floor(Math.random()*e.length)];if(typeof t!="number"){t=e||1;e=0}return e+Math.random()*(t-e)};utils=function(){return{hex2rgb:function(e){var t;t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]},rgb2hex:function(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},hex2hsl:function(e){var t,n,r,i;i=utils.hex2rgb(e),r=i[0],n=i[1],t=i[2];return utils.rgb2hsl(r,n,t)},rgb2hsl:function(e,t,n){var r,i,s,o,u,a;e/=255;t/=255;n/=255;o=min(e,t,n);u=max(e,t,n);s=.5*(o+u);if(u===o)i=a=0;else{r=u-o;a=s>.5?r/(2-u-o):r/(u+o);switch(u){case e:i=(t-n)/r+(t<n?6:0);break;case t:i=(n-e)/r+2;break;case n:i=(e-t)/r+4}i/=6}i=round(i*360);a=round(a*100);s=round(s*100);return[i,a,s]}}}();Sprites=function(){var e,t,n,r,i,s=this;e={};i={a:{x:0,y:0,w:140,h:170},b:{x:150,y:0,w:165,h:161},c:{x:323,y:0,w:91,h:157},d:{x:10,y:178,w:114,h:97},e:{x:9,y:283,w:115,h:82},f:{x:138,y:189,w:78,h:93},g:{x:130,y:300,w:96,h:65},h:{x:238,y:199,w:176,h:167}};for(n in i){r=i[n];e[n]=new Image}t=new Image;t.onload=function(){var s,o,u;u=[];for(n in i){r=i[n];o=document.createElement("canvas");o.height=r.h;o.width=r.w;s=o.getContext("2d");s.drawImage(t,r.x,r.y,r.w,r.h,0,0,r.w,r.h);u.push(e[n]=o)}return u};t.src="img/sprites.png";return{canvas:e,random:function(){return e[random(function(){var t;t=[];for(n in e)t.push(n);return t}())]}}}();Shapes=function(){var e,t,n;n="moveTo";t="lineTo";e="bezierCurveTo";return{random:function(){var e,t,n;t=function(){var t;t=[];for(e in this){n=this[e];n instanceof Array&&t.push(e)}return t}.call(this);return this[t[Math.random()*t.length|0]]},triangle:[[n,2.5,91.4],[e,2.4,83,9.6,74,13.7,67.4],[e,20.3,56.6,26.9,45.6,33.2,34.6],[e,37.1,27.9,40,20.5,43.7,13.6],[e,46,9.4,48.5,5.2,50.2,.7],[e,55.5,3.4,58.9,10.7,61.3,16.3],[e,63.5,21.2,63.5,26.3,65.2,32],[e,67,37.8,69.7,40.7,73,45.2],[e,80.2,54.9,84.7,67.9,91.1,78.4],[e,94.9,84.5,93.8,96.5,100.7,100.7],[e,81.7,100.1,62.7,99.6,43.8,99.6],[e,34.6,99.6,23.4,101.2,14.4,98.4],[e,9.8,96.9,5.9,96.5,.7,96.2],[e,.7,96.1,.7,94.9,.7,94.7],[e,.7,94.7,1.9,93,2.5,91.4]],circle:[[n,100.5,51.8],[e,100.5,41.3,94.8,23.4,87.1,16.1],[e,80.3,9.7,61.8,-2.3,52.4,1.1],[e,26.9,2.8,2,17.4,.6,46.2],[e,-0.1,59.7,3.5,74.3,12.1,85.1],[e,19.2,94,38.8,101.7,49.4,100.3],[e,65.3,98.3,72.4,95.9,84,85.5],[e,93.7,76.8,100.5,64.4,100.5,51.8]],teardrop:[[n,64.1,22.3],[e,62.1,20.7,40.5,.7,40.5,.7],[e,40.5,.7,18.9,20.7,16.9,22.3],[e,14.9,23.9,-0.3,38.5,.5,48.8],[e,1.4,59.2,2.3,66.7,20.5,82.4],[e,38.7,98.2,39.1,99.5,40.5,100.7],[e,41.9,99.5,42.3,98.2,60.5,82.4],[e,78.7,66.7,79.6,59.2,80.5,48.8],[e,81.3,38.5,66.1,23.9,64.1,22.3]],teardrop2:[[n,45.1,.3],[e,49.5,5.5,61.9,8.1,67.9,11.9],[e,79.7,19.4,88.9,30,90.3,42.8],[e,91.7,56.3,86,71.6,74.3,81],[e,65.6,88,53.7,89.8,47.6,99],[e,47.4,99.2,45.7,101.9,43.4,99],[e,37.3,89.8,25.4,88,16.7,81],[e,5,71.6,-0.7,56.3,.7,42.8],[e,2.1,30,11.3,19.4,23.1,11.9],[e,29.1,8.1,40.8,5.5,45.1,.3]],triangle:[[n,.6,99.2],[e,-0.5,90.1,7,82.3,10.5,74.6],[e,14.5,65.5,18.8,58.8,24.6,50.8],[e,29.9,43.6,32.8,33,37.4,25],[e,41.7,17.4,47.9,9.7,50.5,1.2],[e,61.2,19.6,69.5,40.5,81.7,57.7],[e,91.9,72,95,84.9,100.5,101.2],[e,82.8,101.8,64.8,98.6,47.1,98.3],[e,32.4,98.1,15,95.3,.6,99.2]]}}();themes=[["FCF2C6","99BAA4","608E93","50596C","2F2D3E"],["AAB3AB","C4CBB7","EBEFC9","EEE0B7","E8CAAF"],["951F2B","F5F4D7","E0DFB1","A5A36C","535233"],["A32C28","1C090B","384030","7B8055","BCA875"],["E8C382","B39D69","A86B4C","7D1A0C","340A0B"],["A22C27","4F2621","9F8241","EBD592","929867"],["CB150B","DD4F71","EBB289","FDE0B7","7A7E5F"],["941F1F","CE6B5D","FFEFB9","7B9971","34502B"],["9E3333","AB6060","D4D1A5","7BBD82","3D9949"],["85B394","A7BA59","F0F0D8","F0D890","AE2F27"],["FCF2C6","99BAA4","608E93","50596C","2F2D3E"],["F5EA95","FC8E5B","FC5956","C93E4F","3D1734"],["7C1F1F","AD9E6D","8B8557","4A4F23","1C2113"],["4E3906","437600","A9CD02","FDFFDB","A70006"],["FF8B38","F85466","F02999","BF5198","8D839B"],["717A51","7D6745","753830","B46971","FADEE0"],["E2F7E0","73FFA8","6BE34E","7C9E21","AB1B1C"],["FB573B","4F393C","8EA88D","9CD0AC","F4EB9E"],["BFAA73","9C9968","948E41","9C6B3A","B10408"],["B6E1C3","B9E667","B1D967","A3C856","E5FCB8"],["C1E142","E3AF58","F58667","F8376A","362A1E"]];Pattern=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d;t=function(e){e.fbo=document.createElement("canvas").getContext("2d");e.randomFillStyle=function(e){var t,n,r,i;i=random(e),t=i[0],r=i[1],n=i[2];return this.fillStyle="hsl("+t+","+r+"%,"+n+"%)"};e.randomStrokeStyle=function(e){var t,n,r,i;i=random(e),t=i[0],r=i[1],n=i[2];return this.strokeStyle="hsl("+t+","+r+"%,"+n+"%)"};e.randomFillStrokeStyle=function(e){var t,n,r,i;i=random(e),t=i[0],r=i[1],n=i[2];return this.strokeStyle=this.fillStyle="hsl("+t+","+r+"%,"+n+"%)"};e.drawPath=function(e,t){var n,r,i;t==null&&(t=0);this.beginPath();for(r=0,i=e.length;r<i;r++){n=e[r];this.lineTo(n.x+random(-t,t),n.y+random(-t,t))}return this.closePath()};e.drawShape=function(t,n){var r,i,s,o,u,a,f;n==null&&(n=0);i=n/2;this.beginPath();for(a=0,f=t.length;a<f;a++){u=t[a];r=u[0];o=u.slice(1);this[r].apply(e,function(){var e,t,n;n=[];for(e=0,t=o.length;e<t;e++){s=o[e];n.push(s+random(-i,i))}return n}())}return this.closePath()};e.curveThroughPoints=function(e){var t,n,r,i,s,o,u;for(r=o=1,u=e.length-3;1<=u?o<=u:o>=u;r=1<=u?++o:--o){t=e[r];n=e[r+1];i=(t.x+n.x)*.5;s=(t.y+n.y)*.5;this.quadraticCurveTo(t.x,t.y,i,s)}t=e[r];n=e[r+1];console.log(r,t,n);return this.quadraticCurveTo(t.x,t.y,n.x,n.y)};e.drawTintedImage=function(){var t,n,r;n=arguments[0],r=arguments[1],t=3<=arguments.length?__slice.call(arguments,2):[];e.fbo.canvas.width=n.width;e.fbo.canvas.height=n.height;e.fbo.fillStyle=r;e.fbo.fillRect(0,0,n.width,n.height);e.fbo.globalCompositeOperation="destination-in";e.fbo.drawImage(n,0,0);return this.drawImage.apply(this,[e.fbo.canvas].concat(t))};e.dot=function(e,t,n){this.beginPath();this.arc(e,t,n,0,TWO_PI);return this.closePath()};e.tri=function(e,t,n,r,i,s){this.beginPath();this.moveTo(e,t);this.lineTo(n,r);this.lineTo(i,s);return this.closePath()};e.rect=function(e,t,n,r){this.beginPath();this.moveTo(e,t);this.lineTo(e+n,t);this.lineTo(e+n,t+r);this.lineTo(e,t+r);return this.closePath()};return e};a=function(e,t,n){var r,i,s,o,u,a,f,l,c;n==null&&(n=.1);i=n*180;f=u=n*50;l=[];for(s=c=0;0<=t?c<=t:c>=t;s=0<=t?++c:--c){r=e[0]+random(-i,i);a=e[1]+random(-f,f);o=e[2]+random(-u,u);l.push([r,a,o])}return l};c=function(e,t,n){var r,s,o,a,f,l;r=e===d?0:-e;s=t===u?0:-t;l=[];for(a=f=u;u<=s?f<=s:f>=s;a=f+=-t)l.push(function(){var t,s;s=[];for(o=t=d;d<=r?t<=r:t>=r;o=t+=-e){i.save();i.translate(o,a);n(i,o,a);s.push(i.restore())}return s}());return l};p=function(e,t,n,r,i){o.canvas.width=n;o.canvas.height=r;i(o);return c(e,t,function(e){return e.drawImage(o.canvas,0,0)})};s=function(e,t,n,r){var s,o,u,a;s=sqrt(t*n)*e;a=[];for(o=u=0;0<=s?u<=s:u>=s;o=0<=s?++u:--u){i.save();i.translate(random(t),random(n));r(i);a.push(i.restore())}return a};e=function(){function e(e,t,n,r,i,s,o){this.tree=e!=null?e:[];this.x=t!=null?t:0;this.y=n!=null?n:0;this.theta=r!=null?r:0;this.thickness=i!=null?i:5;this.decay=s!=null?s:1;this.generation=o!=null?o:0;this.growing=!0;this.path=[{x:this.x,y:this.y,t:this.thickness}]}e.prototype.grow=function(){var t;this.x+=this.thickness*cos(this.theta);this.y+=this.thickness*sin(this.theta);this.path.push({x:this.x,y:this.y,t:this.thickness});this.decay*=.8;this.decay<.1&&(this.growing=!1);if(this.growing&&this.generation<2&&chance(.2)){t=this.theta+PI/4*(this.generation!==0&&chance(.5)?1:-1);return this.tree.push(new e(this.tree,this.x,this.y,t,this.thickness-3,this.decay,this.generation+1))}};return e}();i=t(document.createElement("canvas").getContext("2d"));o=t(document.createElement("canvas").getContext("2d"));n="#ffffff";f=[];u=i.canvas.height;d=i.canvas.width;l=!1;r=[];h=new Image;h.onload=function(){var e,t,n,i;l=!0;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];i.push(e())}return i};return{pattern:"tri",canvas:i.canvas,generation:0,ready:function(e){return l?e():r.push(e)},setSize:function(e,t){d=e;return u=t},draw:function(e){var t,r,s,o,a,l;e==null&&(e=!1);i.canvas.width=d;i.canvas.height=u;l=this.generation===0?themes[0]:random(themes);f=function(){var e,n,r;r=[];for(e=0,n=l.length;e<n;e++){t=l[e];r.push(utils.hex2hsl(t))}return r}();n=f.splice(random(f.length|0),1)[0];i.fillStyle="hsl("+n[0]+","+n[1]+"%,"+n[2]+"%)";i.fillRect(0,0,d,u);if(this.generation===0){this.patterns.star();r="UNWRAP ME!";i.restore();i.translate(d*.5,u*.5);i.scale(8,8);i.rotate((chance(.5)?1:-1)*random(.2,.3));i.font="20px; Arial+Bold";i.textBaseline="middle";i.textAlign="center";s=i.measureText(r);a=s.width+4;i.fillStyle="#000";i.fillRect(a*-0.5,-7,a,15);i.fillStyle="#fff";i.fillText(r,0,0)}else this.generation>10&&chance(.5)?this.special.doom():this.patterns[random(function(){var e;e=[];for(o in this.patterns)e.push(o);return e}.call(this))]();return this.generation++},cloneCanvas:function(){var e,t;e=document.createElement("canvas");e.height=i.canvas.height;e.width=i.canvas.width;t=e.getContext("2d");t.drawImage(i.canvas,0,0);return e},special:{doom:function(){var e;h=Sprites.random();e=random(200,280);return c(e,e,function(e){var t,n,r,i;i=random(f),t=i[0],r=i[1],n=i[2];return e.drawTintedImage(h,"hsl("+t+","+r+"%,"+n+"%)",0,0)})}},patterns:{snowman:function(){var e,t,n;t=random(180,400);e=chance(.5);n=a(random(f),100,.1);chance(.7)&&s(random(.02,.05),d,u,function(e){var t,r,i,s,o,u;i=round(random(3,5));s=PI/i;r=random(4,20);e.lineWidth=random(1,5);e.rotate(random(TWO_PI));e.randomStrokeStyle(n);u=[];for(t=o=1;1<=i?o<=i:o>=i;t=1<=i?++o:--o){e.beginPath();e.moveTo(-(r*random(.8,1.2)),0);e.lineTo(r*random(.8,1.2),0);e.stroke();u.push(e.rotate(s+random(-0.05,.05)))}return u});return c(t,t,function(t){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;t.shadowColor="rgba(0,0,0,0.2)";t.shadowOffsetX=0;t.shadowOffsetY=1;e&&chance(.8)?t.randomFillStyle(n):t.fillStyle="#fff";d=random(20,40);o=d*random(1.2,2);c=d*random(.1,.2);t.dot(0,o*random(.9,1.2),o);t.fill();t.dot(0,0,d);t.fill();f={x:d*random(-0.2,-0.5),y:d*random(-0.4,.1)};l={x:d*random(.2,.5),y:d*random(-0.4,.1)};t.fillStyle="#000";t.dot(f.x,f.y,c*random(.8,1.2));t.fill();t.dot(l.x,l.y,c*random(.8,1.2));t.fill();m=random(10,25);g=random(3,6);u=l.x-f.x;a=l.y-f.y;t.save();t.translate(f.x+u/2,f.y+a/2);t.rotate(HALF_PI+random(-0.2,.2)+atan2(a,u));t.translate(random(5,10),0);t.tri(0,-g,m,0,0,g);p=random(30,40);v=random(45,60);t.fillStyle="hsl("+p+",100%,"+v+"%)";t.fill();t.restore();s=o*random(.35,.5);h=s*random(.4,.6);i=PI*random(-0.1,.1);r=function(e){e==null&&(e=1);t.strokeStyle="#000";t.lineWidth=random(3,5);t.save();t.scale(e,1);t.beginPath();t.translate(o*random(.8,.9),o*random(.7,1.1));t.rotate(i);t.moveTo(0,0);t.lineTo(s,0);t.stroke();t.translate(s*random(.5,1),0);t.rotate(PI*random(-0.2,-0.3));t.beginPath();t.moveTo(0,0);t.lineTo(h*random(.8,1.2),0);t.lineWidth*=.8;t.stroke();t.translate(random(-2,2),0);t.rotate(HALF_PI);t.beginPath();t.moveTo(0,0);t.lineTo(h*random(.8,1.2),0);t.stroke();return t.restore()};r(-1);return r(1)})},box:function(){var e,t,n,r;n=floor(random(50,200));t=random(f);r=random(f);e=["source-over","destination-out","source-atop"];return c(n,n,function(t,r,i){var s,o;t.randomFillStyle(f);t.globalCompositeOperation=random(e);s=n*floor(random(4));o=n*floor(random(4));t.rotate(HALF_PI*floor(random(4)));t.globalAlpha=random(.5,1);return t.fillRect(0,0,s,o)})},star:function(){var e,t,n,r,i;r=chance(.5);n=random(.2,1.2);i=random(80,200);e=random(.2);t=function(t){var r,i,s,o,u,a,l,c;o=round(random(5,8));s=random(5,60);r=s*random(.1,.6);c=0;l=TWO_PI/(o*2);a=[];i=random(e);while(c<TWO_PI){u=s*random(1-i,1+i);a.push({x:u*cos(c),y:u*sin(c)});c+=l;u=r*random(1-i,1+i);a.push({x:u*cos(c),y:u*sin(c)});c+=l}t.rotate(random(TWO_PI));t.scale(n,n);t.drawPath(a);t.globalAlpha=random(.25,.8);t.randomFillStyle(f);return t.fill()};return r?s(random(.05,.15),d,u,t):c(i,i,t)},tree:function(){var e,t,n;n=a(random(f),100,.2);s(random(.02,.05),d,u,function(e){var t,r,i,s,o,u;r=round(random(3,5));s=PI/r;i=random(4,20);e.lineWidth=random(1,5);e.rotate(random(TWO_PI));e.randomStrokeStyle(n);u=[];for(t=o=1;1<=r?o<=r:o>=r;t=1<=r?++o:--o){e.beginPath();e.moveTo(-(i*random(.8,1.2)),0);e.lineTo(i*random(.8,1.2),0);e.stroke();u.push(e.rotate(s+random(-0.05,.05)))}return u});t=random(120,360);e=t*random(.2,.8);return c(t,t,function(r){var i,s,o,u,l,c;r.translate(random(e),random(e));s=floor(random(2,6));t=random(10,60);o=0;n=a(random(f),10,.1);c=[];for(i=l=0;0<=s?l<=s:l>=s;i=0<=s?++l:--l){t*=random(.8,.95);u=t/100;o-=t*random(.6,.9);r.save();r.translate(t*-0.5,t*-0.5);r.translate(0,o);r.scale(u*random(.8,1.2),u*random(.8,1.2));r.rotate(PI*random(-0.025,.025));r.drawShape(Shapes.triangle,2);r.randomFillStyle(n);r.globalAlpha=random(.7,.95);r.fill();c.push(r.restore())}return c})},snow:function(){var t,n,r,o;o=function(){var t,n,r,s,o,u,a,f,l,c,h,p,d,v;l=[];o=[];f=random(10,20);l.push(new e(l,0,0,-HALF_PI,f));while(l.length){n=l.length;while(n--)if(!l[n].growing){t=l.splice(n,1)[0];o.push(t.path)}for(c=0,p=l.length;c<p;c++){t=l[c];t.grow()}}i.lineJoin="miter";u=floor(random(3,8));a=TWO_PI/u;v=[];for(n=h=0,d=u-1;0<=d?h<=d:h>=d;n=0<=d?++h:--h){i.rotate(a);v.push(function(){var e,t,n,u,a,l,c;c=[];for(e=0,n=o.length;e<n;e++){s=o[e];i.beginPath();i.moveTo(s[0].x,s[0].y);for(t=0,u=s.length;t<u;t++){r=s[t];i.lineTo(r.x,r.y)}i.lineWidth=r.t;i.stroke();i.save();i.scale(-1,1);i.beginPath();i.moveTo(s[0].x,s[0].y);for(l=0,a=s.length;l<a;l++){r=s[l];r.t!==f&&i.lineTo(r.x,r.y)}i.lineWidth=r.t;i.stroke();c.push(i.restore())}return c}())}return v};i.shadowColor="rgba(0,0,0,0.1)";i.shadowOffsetX=2;i.shadowOffsetY=2;t=function(e){var t,n;n=a(random(f),10,.1);t=random(.05,.4);e.scale(t,t);e.rotate(random(TWO_PI));e.randomStrokeStyle(n);return o()};n=chance(.5);r=random(80,240);return n?s(random(.05,.1),d,u,t):c(r,r,t)},scales:function(){var e,t,n,r,s;t=random(80,120);e=t*random(.5,1);s=a(random(f),100,random(.1,.2));n=chance(.5);r=random(["dot","rect"]);i.globalAlpha=random(.5,.9);i.lineWidth=e*random(.1,.8);i.shadowColor="rgba(0,0,0,"+random(.25)+")";i.shadowOffsetX=random(-4,4);i.shadowOffsetY=random(-4,4);return c(t,t,function(t){switch(r){case"dot":t.dot(0,0,e);break;case"rect":t.rotate(HALF_PI*-0.5);t.rect(-e,-e,e*2,e*2)}t.randomFillStrokeStyle(s);return n?t.stroke():t.fill()})},polka:function(){var e,t,n,r,i;i=a(random(f),100,.1);n=chance(.5);e=random(.2,1);if(n){r=random(50,120);return s(random(.05,.2),d,u,function(t){t.randomFillStyle(chance(e)?i:f);t.fillStyle="#ccc";t.globalAlpha=random();t.dot(0,0,random(r));return t.fill()})}r=random(50,200);t=random(.5,1.2);return c(r,r,function(n){n.randomFillStyle(chance(e)?i:f);n.globalAlpha=random();n.dot(0,0,random(r*t));return n.fill()})},dot:function(){var e,t,r,i,s,o,u;o=random(20,200);r=o*random(.1,.2);t=o*random(.5,1);s=random(.5);i=chance(.3);u=chance(.5);e=n[2]<40;return c(o,o,function(e){var n,s;if(u){e.randomFillStyle(f);e.globalAlpha=random(.1,.8);e.fillRect(o*-0.5,o*-0.5,o,o)}e.randomFillStyle(f);n=random(r,t);u&&(n=min(n,o*.5));s=n/50;if(i){e.dot(0,0,n*random(.05,.1));e.globalAlpha=random(.1,.4);e.fill()}e.rotate(random(TWO_PI));e.scale(s,s);e.translate(-50,-50);e.drawShape(Shapes.circle,3);e.globalAlpha=random(.4,.9);return e.fill()})},leaf:function(){var e,t,n,r,i,o,l,h,p,v,m;n=random(f);m=a(n,100,.1);o=chance(.35);l=function(e,t){var n,r,i,s,o;n=t*random(.2,.4);r=t*random(.2,.4);s=t*random(.5,.7);i=r*random(.8,1.2);o=s*random(.8,1.2);e.beginPath();e.moveTo(0,0);e.bezierCurveTo(n,r,n,s,0,t);e.bezierCurveTo(-n,o,-n,i,0,0);return e.closePath()};if(o)return s(.25,d,u,function(e){e.randomFillStyle(chance(.75)?m:f);e.rotate(random(TWO_PI));l(e,chance(.15)?random(80,220):random(40,80));e.globalAlpha=random(.6,.95);return e.fill()});h=random(100,400);i=random(3,8);p=random(20);e=h*random(.2,.5);v=(e-p)/i;r=random(10,30);t=random(.5,1);return c(h,h,function(i){var s,o,u,c,d,g,y,b,w,E,S,x;n=random(f);m=a(n,20,.1);E=random(1,4);s=chance(t);x=[];for(g=S=p;p<=e?S<=e:S>=e;g=S+=v){d=g/e;c=2+d*r;w=TWO_PI/c;h=random(10,40+20*(1-d));x.push(function(){var e,t,n;n=[];for(b=e=0;0<=TWO_PI?e<=TWO_PI:e>=TWO_PI;b=e+=w){t=random(m),o=t[0],y=t[1],u=t[2];i.save();i.rotate(b);i.translate(g,0);i.rotate(-HALF_PI);l(i,h);i.globalAlpha=random(.6,.9);if(s){i.fillStyle="hsl("+o+","+y+"%,"+u+"%)";i.fill()}else{i.strokeStyle="hsl("+o+","+y+"%,"+u+"%)";i.lineWidth=E;i.stroke()}n.push(i.restore())}return n}())}return x})},tri:function(){var e,t,n,r,i,s,o,u,l,h;t=random(f);s=random(40,100);e=random(.6,.8);r=4*floor(random(3));h=a(t,100,.1);i=random([h,f]);l=chance(.5);n=l?chance(.5):!0;o=s*2;u=s-r;return c(s,s,function(t){if(l){t.tri(r,r,u,r,u,u);t.globalAlpha=1;t.randomFillStyle(h);t.fill();t.tri(0,0,o,o,0,o);t.globalAlpha=e;t.randomFillStyle(i);t.fill()}if(n){t.tri(r,r,u,u,r,u);t.globalAlpha=1;t.randomFillStyle(h);t.fill();t.tri(0,0,o,0,o,o);t.globalAlpha=e;t.randomFillStyle(i);return t.fill()}})},bead:function(){var e,t,r,o,a,l,h,p;t=n;e="hsla("+t[0]+","+t[1]+"%,"+t[2]*1.5+"%,0.5)";i.strokeStyle=e;i.lineWidth=1;i.lineCap="round";l=Shapes[chance(.5)?"teardrop":"teardrop2"];h=l===Shapes.teardrop?40:45;o=random(.1,1);r=random(.1,1);a=chance(.5);p=chance(.5);p&&s(.1,d,u,function(t){t.dot(0,0,random(2,6));t.globalAlpha=random(.5,.8);t.fillStyle=e;return t.fill()});if(a){i.shadowColor="rgba(0,0,0,0.1)";i.shadowOffsetX=0;i.shadowOffsetY=random(2,8)}return c(random(80,100),u,function(e){var t,n,i,s;e.translate(random(80*o),0);i=0;s=[];while(i<u){n=chance(.2)?random(160,220):random(5,120);t=n/100;e.save();e.translate(t*-h,i);e.scale(t,t);e.drawShape(l);e.globalAlpha=random(.5,.9);e.randomFillStyle(f);e.fill();e.restore();i+=n;e.beginPath();e.moveTo(0,i);e.lineTo(0,i+=random(5,50*r));s.push(e.stroke())}return s})}}}}();Bump=function(){var e,t,n,r,i=this;e=document.createElement("canvas");r=new THREE.Texture(e);n=new Image;t=e.getContext("2d");n.onload=function(){return Bump.setSize(1e3,1e3)};n.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAAAAAAZai4+AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOERCQkU5NDlERjhCOTJBOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowQjQxMTY3QTIyNzExMUUyQjJCN0FFRTdDNTkwOEVBMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowQjQxMTY3OTIyNzExMUUyQjJCN0FFRTdDNTkwOEVBMyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M0IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAxODAxMTc0MDcyMDY4MTE4REJCRTk0OURGOEI5MkE5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTE4REJCRTk0OURGOEI5MkE5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+8lZPfQAAMNNJREFUGBkEwVmyYzmWGMC3//3JTK2uzIhH8gI48wzWp9x/LNxOs0zhN+SyB7yCd1F2x5Day1sljcvohvbnZnBcvPq6phfc8VzzAZeWIroZJdRbJ3KYLqUKFZ35pVT9arY8GefyunIacWKGZECz8XKn5CyZHx3BWjBQvZnlmX1iMvbpb7RZxRnmSZ1tRTPMdZ6eTCNHLv13tuShoeVRjU8gD/BIjEwVX8YWGfGWp6/0ZlftZQkyldc8+TUpg+seTNH0lZQpPyFyQS8+9YKBTp3eZzY0v4rWfCxOjDxBPAwdPHiGrZ6nPp0fDZQBbHs3vAdp+N3EsXgIxyBIRrjluSyIlq+PK8V+NXc6DtvopwDjWCPF1lG9G67tH/FeaqDJ5yJd5Ys+EbLfZX/z97kIFR5GLWjMubXs00beJcTF7FuGLfV9xcazLCag7TT76FECN/NY9T7XT/7R3m/94Cyqh+Zg6+k38oOjlmnAeIn7ZzPR7HcezOTQRwFm/K5oO9VnYhlJvI/TqmQj/R6YzapZnlGURJc4lSdipJK3HWvCERzBe058MnGCH1pULWYIf7H1jKwCnMfHOLd24pjG75Rj7p92HsN4nvnEhcfptErDnue0SIOWQ4VO7nFI1OZVwG3cuBtNDzSzH+nNo1Ruw+8y6j3XqOQ39D2HelEcCorUvELGVIwGMPXuhR1+mfyxcR+T2fiT786jDJXP+L6/Z/TfPtuR+iO59v1ocwpCoo2JsfvySGp45YJiGoW7d7a0ZJsOey/R85+m3xQ0EHEWht6fWpZMYU/6p/Tk89SwotYy5x7AjkjeDWt+PNkCLBaGWfEe2L7Fd/fh5lX04g/ez843duHQGuB8SZAYHVWs8KuVT87SIfu+KZY6Eu25XFdx/sV50H11STLlU4kdy3uxSF45U6fp8S1jMsTNK/znbmu1RMyPX6lRLjvtfXkn41jOsflnTeQQ54Zw8tQv5mW91T1yhbv3V+iyxX6V2Ry/QRFdO5zwmo55ixdKXrrOl8BvX9DZGsKX7LKVf0rrMueRH8d7yIWK3lN7KMskiRMeXeIa1/G7D8fOA410X4ZUnHsgAt2dkqwl0t6uUbvT87uWw5+kVaIlOCY3rW3XpmFhPQWfSzo0BTxRN3BE07LXHtpJe37k8krb80GFFVj1Vxt4/mfl+bQ8JZlmRdWMQT5y5pfreBwJxv7shHc+5eyOMab9oSvLYZww0K7wuI2iwc4HW3rQQzVxt8gohZ4rkoyF1KC23NeJ/TPMKVq6L9Y82v4ePh1/e73Vl6+ovYptDIZogp2ePPhd0HparIxycy7uQ1PVcSZOCOdHKvkWJn2cqLYMgZ9qOXMwN+aKm9CKDdLks/keK3jVx0P2z5FWGyMHd1oDao+VoVGm+uw9BsXW3A0081EL3xZ0xqSUC3NiJ2ML/5e9t5nElZPrXQlj3iG9IZGDdeokmhuX7Ptsrz2plaIfycfqyFAEYPGuH2/hCxbnqqit4//zR97k75pHSrc5xs4hTSJ/oOncFzV2BQ9sfu9BzDpK6vY4rCG/TvUcl6pV/rsUQfHhs93PAAxickk9ec4ssnPGpZ6PvT5NZ5bHe8f+Ka0O9Vjx6/1rdd4Kn5FX8vbXW2jnhtm7n1ObA3TkT+s2+fRI7pW2mqWIh9r/ZEvM2X36PsfpDDwN6LqauE5UYvOnQRzIFINPoAeLrVW8mmxozXOG5Qf5mrr40B6z/5qmnjZNvZ1SyqEwR0fo61xqJZ1hHFgmTjBJ9/DtuCr9F74xUzhE90DTGt9NfEfvPX200ypx7BlexX4fKjwlco+OxiAESTNZUf2c4riZd2d8pIIv/zry/CdutHjO2ZfjYkx7A43p0FObErhiK3362PjXNEojNl+JOp+Gd1HqYQf9hl6Q/FLrTqdizIWF1OXFkez6JjdRtrvdVZi2Pz+NMi9ogH6o/mgw52snrjooisnmgkrcbxmwNHP+ZeB57/7w/FI8r1az8/RHQ8gX9gL7+PwFE2xst0+td+uxRfEbAdILZrlTzGll/67TLywh11fyM4uGnp/QYWHC7J2SgzxCE2gmrcjIs7tNy7RBrvgYF7mzekmyfJerQyuX6DCP9YgNcZz/hK65/j2m/BRTvbwOmS+PVxqmY+i6QF369d8vYAeYySQ6PfmjFynOniNWXE5j3KH1sTa8wn0+AX6V8/VkaRtc9TlUSOmnFa+4Kxj2iFw9w5jgQyfAb6r6vm/vEy3QtkdzHqtHs2KIrkm9vBIC9YvSv+igdWToJ3Xng0VrdvS7/dCVHc+78TTAGKvvplXv3wYueNdAGvkv9b9PPKWq6RC/2m/y7cUfD6iD/RdG+Pqn6iWPXRBbmp934nM/+EVvkfq8C/40av2VZBhbuiA+YuvzM59yalxAr7H9faxV26Tk1MbZ1KR3r4TVwsOQx+MQ2zL6iwL6V0UpGOYDlsdEE572l+EnXNx1EFSsHPLvGXnP8zRS8vuaT64sjbB+/g5wkrRwMo+950eHXEmGLBgkYyKLq6HseeLM3asp7+peXG4j6/uH4+1OaiIAfwelKVxlRBt2IRe/C2lMC9Yk6ScmtPRJXR2YwAnhnE1YtOZf8/qobQdy2GW3g1p+7PcTZKovfr3jDxBrvkg3jp5Ye+oofgJe8ex2ZvuE/srnPafniQtA+BqDC2s2ar7lVD+bnpjrd+08e5ij3vPCEqrftcUvQG5uRYLfgP+Ta8H/+KU3v/+1fM2mOfCTGHfXlolfNem3zofGkKSmZVZ/qdooVUtDlestuTlti5050MtLbWyXy+wnmZUhwAZ1WnprbgrhKjSYSzTG4WqGYTiO81DVmuJ56DIwSckTqfPD17UcJbwOJa7RHI96fVt0LC77KBdQsl+mAbjrtHC8vA0d9L48Q4XSCcvvl6XoNKrok6wtVoKXJWJfsHl6NAY6VG9ZW17zRnI+HtKaBVIPTP7EMVMsOaF192dIv1k3ljuKcUsF++Axsun3uIj5NNxVw9EY4c+A9l+8VL13irXmd/b1uLFTpBuapf7J8lUCZXBJvwdHpTVaznxktjvyOCX8+6Ud6j/PQ0LFyLRG9+iZ5AHPkWLtB6+5i4phhzaC/2LZ7sSodxsOVIB9Rfq1e6uT4j8wAlpU8OlC0qOgIe9W6ODC4+YldJ9nikJY+N8ialkB+34oeid+7Gcl2vU1CwpYjA33nOPBvaXgt/h1Aef/ZRH0+UQ887B/vGnx8cQ/998j0qHUqL3i0qtD7SUJH2frFw/nhc4jCTq0ZlNuN9NhnpD792FCVbLDIxFoJlz4g/td6q7QQrS1ya+eDh59Cp98Q2xL+y0nRSyusuUsg69+8v4epzObexm23NxVMFTX6L4442RQ6Jmhwbr4NHAYzJZ+pOn0gcT/zc+pXaVcHv163z/Qm34QiqWWl9K9p/ncs2qnGeSO2Z8LUMTh73uwzu63FZjwSocrvw4ZoW3YFMrk75kPxalRrd8nQxPAH/fnM8SJB1GCVjLH8w44tj8Cq/if2dSIzW/txer1Q8PeuMaFNb12wrH1ySO2cJRNuZ53nzOPmT3j/7HDKZR4Ox6n40K9ENn65HdtZ1TYo2z75VZpa9AGPNjGPn38vsiWBb3zo6na0PUct0fff3lrbi9VOz+zn/Kn4Km/KKLJnoitekX7g1/Yak/jurCndTIm0GN9V11ZiREiY+oQLXg1x/wbzxDc1oETfZpiDl3sMRiyW5hr51+KI+NPabVSAtWSZvzWGdNJ+jG9kuWeF0ZxhPtIsVZQs1XLV26bWnb7Hs77sSYU3DfM9VyqK6mi4zqutcsJB8O+NoLjYiGtv2HUjxjZiBdRBd8d10vhmXzuou/sDh2LMhDk/JHE1Z9X/dE6lgC+WUzawzgKu50Gn7s10JqO7n8LjqElrKIz8Bqg/DylqA81rfvREpxfMkUHbpJriYcTvV/Uov2oHSimLshDIVAaN3kgbZ9JalRfPyU2H5V+zaHanYrFXvDoW5tYD/pCXL8jn3pDa4V+mvacd0OYgjoYnnzBoAxKE/ff7ettEPWcyVML5t2xZYyqYXD5e12QKyeQh5n16YNJZPC0yfipt/0gXQpNd4er24SvnnbPjc5Wzr1t1ANyrIKfyys/p+vjHqM5hu7WByqe4XJJ0Qgh2TLqHaeF2k45TMjoacqOR/SZ0BRplpvUD9frqQ/Xg7m59uofu0QjMCeaIPTxcy57PTUJebBiDd55yYAUnc7nhhduAx/aja9EvxD1Kw6uusoyTzXcYW6j+eUUczx0VjFaysUThwJPb8oFLWgPBqxa2gX9n628bP30RwaP5995Z71R7J3r0897PusiDixBaDpjUcfi8MQZtO8m848gBcls8LOS9LK2ruFPEc0bM2nea/byP5APDOQoz3lmfVq4nuO/2AcTMUmCqP7C7OOMResHdsvbkZ1X+75/7PLJzS27txX7l6Q+OvpM8IjNlny49N3MbThGTZw7jN99bA6MnTpQIxdj/BRQwT8hGMZFaxArofxcoinqo2PSLq3Sfx9VUsKW6B8r41bPgRs55iOSsuZjQ1wiQ2cwAq2j7/uM/QkC/ZhuHgPlfQkGxeBcw4lPv6Ndr3B5XYUL3AyFS0xGuG/cl+ahUDTFr4XrDPIsKCYDHtM50eenP1a4ynjI8uSQzqaGP7G3AJnyJYvQe7SRQ478l+7iu55wKtmXscUGrUYvydivKQ7RbLbIy9KORZxrOIqhh2E+Opsy/k7YpRijkU+qXsMrVqqu8XMOHSs3SRA8zbtlxVnxeFvU0et4lccxZMWW2RbriFJuGyNDrTkR3LQjpfb2Q2ZrSquWgxVKo93Ru6GMR1e638B5gzoWd9EZiFYe8dbTxMlVP54GA1RYHXwJRq1U+7NDJQSdw1Fa2CI61xheyEsxdAbl+tzCFmpEghyjBr+tF6SM03jIb56b2z3M7Ft4KXvY8gmzEhmkIWlxOzhMc2aEp35uUtunEoeOSTTouF6hZu+EUbn7DK7xuGxFNEzjfnmHk0u3Uqak6Dhei1t6gZ0+F6vzZHq4NOpAD8YoZ56vwmUfwcpTyK1+Kab5ol6nVJtNP76GNf96mNaKOjRJYR6qfcCAXXHEiz/1frdxkSaqGTT+loZ/YgzSsIruBhMZXv2yYmjTEklcDTb4pO4Gi6aoTxBf5UZI0iB2ZUcotpvQbXMqfqhlz3L7S4OkFX4gt96PTVGgtMgQBjnRh2ENYnx0znWrYmt4X8MWbLBknnTLNUrJWj4NNUoNn2guW71I6jG89RtK00MDNkyNnbEuPC273iLc7T/DOpC39rgW0AgU0AC0xUjOIwF2Ra7KVUu1q59b9JVTRGkSHsPZod3SBKXYqEnSIhc4nK9Uhzjf0XXZ7+YvYDznpoTuMb/izNxhY5xbHGjAf4TS0bYnvurY6B5fSkQgCdu2FQgzGj61VXcUaMaK0GH8hkzSOPruYujP+eLTB3vxyCv3k+cUgQWGvYt1ZMmOrHD7Jy1vUmFPvXLz5ZWfV9n2BfxA/1CX9kMTosCTq+UU0Cyd91y3Im2EW224WiaRvht73+YMQ859+TRzP5B2rFYAGoIvGrKBGHrqs/pz+LGRFWADc1kjud0CaEpcTgkNiqHW/5NiTvgZ9KvvDJqQUQnm9N3nXLNL9W2dI2OSrHefQfSmYZmN+QdKfLbksqsr+dLjqZFq9ZwuuUsGMImb4f7FMZjnXnnNkeFTrgFnzObIPDks37aBvwMwUD/vc/NJi5aYRDkQe197uWjWZeox9q0jNvYkaZ8otRoY+09ifOXY/qSRx8m9vwT5WAP34lnUi/v1uO7iIw+3iPcInmL9L/ptCPIxaHwuu/lWOcHsrP1zSvnCuhANdBVDIUHmP6Z/pIz72DgP6GgUHWOdw0k2yELVx82pmRsjA9tl3h8G73RGiE/FPrVh3uYedZ46u0HqjDlnssGZj6ZasjVbPhmbjayfn5FJoMadOuNxFd350p6zR6DUMncB2uE61MytXPL8l97f1+7d4xggyTpvzpK+ViKVNHwaZFiDdr92fzQ+j20K48vSiFfuEI18Ltf88XpkLC9RrJ3mP8aj28HzEQcd5UEet0Jt6+A99dw3dLw6rdmbmFgSn1ufqz41glFCtt+XtAlb9JqNyi2twKZK2yL/k4ppEoerTh0YkP5Ib81z7nkPfxrDtyaTesUPNJ7+Q806yiUc8EnKu8gRBjgLK2hQ03WYiz65xE15kYtHrGmdk26cSBP/3EbVU0oj3ITD73rJoOvGeJ9m6lUG6qijKIL9TLs4rqJolt4y+8n4ybMLV9G7NucK31yCvf/mElnrutR+t/jIadIGnvzH1qcsZsEgK0NRDfwZPR3S+DeeU8Dzxtq/QYT0b7z/zh/sfYqr89R+XVUh6s9H9q6FBdRGBc/wqzlL6GefNm/lys9lm9IRuSjVIiQh/jUeQSe4sa5LeyRJDo7wSNwd99RV4dcpyfRoxGnUWok6Rr1o7O3+d7jm8CzoIbcTcoatPFvgPnFThk5qFOkox4+Oups2WVe3coBH05c1VEt0WEazH03W2tqqHad2O2jRromvxzRV7kKMcmHu6qkRxKsxHzYjeZQYL/wGwEUrxiQewdp0Ab8niqpda9HFdZOGfpKiDNS9uZujn2PrVfB3WNtOk09GG87CATLHoHOF76Je2jvHT4kW6Gz4sqRon1e552fPoYaX9z+F/8mXpDpJ9Yb7h0ek3Jq1n6eI88OFfO0Z40mP/fwgW/qoa8PI/gp8zRqIzk7Zd/PtuqK8cQRKuIA7pE72nMhz6WmRUSVco1rHLaiUJ7iV+/CEh5zmJ3E3UB9To1S5SK04spJOA47bZW6lqD2Y9eMVMqm9lock63X1p/zxZgmBxPg2tGodG6rZ/N8PxSE7k5fIs9wdsl9eT07hjbxDQ1zuo16Csy1EXYUB8s/fTGoLLy+FNLvPrpIBDK+LcdWv7KCfWTpLJveA5l9K92AZ5haeqJunWSY/l/Aems/flHdhXFgBFb8pAFdw5BRQAvmcMh58TKMPzyE/fwfX/VeS3yNsvvPZs7GeHcv7UMDtzUnhew2cYTa3HxXZ4MwCa+CfQdEDptuB8tnCbL92bRe+BD7C285fOdb+Unxa+b7PlY0PlD0RKz9s4CWn6d3CaT7ySKLwn6GnKXqB0T8B7wkq4E5s8BEup9RHAXhjg8wPTbAyM7Ip1ngRD2iztFSrpMrXctjcuQXuptF9RetwsVTp8Mkj6TKhl8DZhn6L1piP8Zxd2+4nhvkytkXvdhaPNM1pbn0RUglf4cCqf3cfCfkJ8dvHGZtiQIe46rTvGXfIfuK6lehsH5EJH84xmEcV7EsdkAP2FbwqV7BDi700pv2aFqXpewy/BtdqHIZptnwNSyhjJuymzaKhaF+j72vSW348y2Y2Jujov0P7u/ULEee4+AiV6hxrliRMnmZtpEHo/nfyfB8Z4osUIs0yBsF2KS6fW8zM+c/HWCXOSKbhqJVCCTVbIhXa1+wyTO0rfJX6/I5K/XAmXDrzl8vdiI20Tty1EakxPcF53cVNyxZO68BpwKC3/fLk07YHup9VbylmNh/1MGjiIWq1WRYfCNmD0Z3zOP1qKjdjKo3QvGsCPO0KDmlxKP6EVBte2/3IPJH7t3hfW33oPnDdi3bZu9krnjIowDw0KkVeDJ0g6zShPngBW7BDR3YD1qkJTv2kvOblw2eExrA+UItUIQlc/ibvfHCuFVvtM2Rj8iN7VI2wCi7vci6VsQqOm27E/e6CSs5mHtmGariLoDd04H8BEyBZB9+hGGAmEHHMfULbJXeLHLenES5Thyctx3cqX9bJIICkHAX7V93IlTqxf+QqDUIklJldy7Qmb4MJG+YOKTydUhJ3f9qNYQXxMBrLFM/ehRysE3xlj8rgMs44XCrN1I/22ZEYB5NpxOMdzjBHymLOSlmm2Wd5SaxoZuefJCrXybif3/jjdch/oQBaac623+PytpAbWuX5y/UHcnFa9/99t5C4FPMAjNM1K6Z6g27Nz6vOEoaQv3b+DIS/seHdhCVnjuV7pxw+xxXDNPZygOHPJS6EHzipFuCOf0PUNtB+RsjFRirsDtHgqngunzZtpDLVWmNaBB092uPcuCpobOeWk/+jNBfV7c54oYacwQz5jHyGPo0mv5yiZTJGFqdxd6BijYLDzp9PBs/CeZxTr0shjPi41XMGTulqwNpnvt6VI+K6h2sEiyyPXuHkLKGmGLEx/L7Fy4rRC0fyq3rl28lDfEMDxR+9eDpw1IMxQXrLOE3HNevE0J8JG94Gv5d9sMtsivrgKF+1URz2xJWP9Ztjaa93cd5Hhtlh2pD0JGMwj8glDPp3XhR4LnPzp4e+AiM8BP2AY9448/lkWyskaazdhG37ilyB4O1v+1EqOnlAPtQucqwfHtAM664vwyWdOE3/1nm1LT9PIF0Oo2wWO3Q5hrDxPRJ6QLdJ/46+vKWZ4ognJX/mQKm3VBrn9gFgs4FgA+UztMdWHPJLLSt/dDjnsfmVcc/W4gphNbRY95qA1+JhyWHHnGQjnYQ6ewSbsP9OmwdaG09F4HN/r52so2P3azxILtLCTThMpRIMjW9dVBwXKEGGVuu+DP1kKxn9NPstdXmP9JD4Uia5Ap3UrIFYkn3gbmqGwHCJS9iwSuC6pGabjkZiDGqTZj7zJvnoBH3F/Pwd2hfpbgrYwxEbR6GFWtbk7rX87FmTj4xov6AZfnBlv+0Dch+hfU2CUwlCrJe6kwmW0Oifxr9+Vu33IPc5uTAIG6wor1I81PhMch0WeueCpieIh8gFlHg+IvzEh2d9inEAp2iOtTy5uOhPoZhxyLvwN3+wjfMPzrP8YOVx5JbTDA3aJ4JkzJrDmTKnvzTsqRh75+eTHC1rmJqgR4bjEt3/UJsNfgK1mv+7tcmNdUKGswMs4Aa0WwZclNRdUoHUUdc1acHfH12SB0bM5ZnQMOiKr+jYGeK7wSC/hfe1M3XipHjvM4JX96UYs7Dt2JdwdI1DYl1aQz7BUnBBL8J911UcjKEzf3dLJ8q3tMiG1yyPj94PGz3fLXfrD8ONj6CqacdpsvbH/bhbowzL3TjiBtSCjT2buiUPmb+7X/VUHwqSXFDOLZQfHV3NOAStOEoVVl8o1pa/QYixLKWJS+KeJ+tTZ83rIwHNKvS0nPrZbWcC7i8mPZemPjTq/QujMHYaIytGpoJC/Eu7QFusT7pobuz9r52Jk3WiOQe48J1yUymOjkIdb1A+K1GSakiDJekUyzCnUqOEvhmsH7YVcTA+P0o4kZOvab6nZmJEZz/TrGohPpHDFPuMrRtSJjeqK74759zZ0tBXSN/QGtU+8JSD4UqQy7vpNfLpN1z+Xol7Xtew2EKeZG+Vy2fe1aCXICQu6j30Y3Pl5EPCE4B9sA+NvF2imIrWaLjCtT2MkVYiY3dYKhfDK985khdihCZAeVyh9unPSuMhUJFWb/ubQkHiRhbbIm9FKzeE2rp2aj/NWMbNOLz9R8ddWOrfHUtbVle0YD9S8uT5BEMFBGAIFrZRJnoA9y4/J/CfptCzbGsbj2LiKqIWMIUmmF9qiFwtLLGsFwp4Psmpik8xzufYwZhTdAIg6KlfcPypF6bgl94NPCpxTMIawehJ4v6wMl/gghuuTjr5LpVm7D80wJrkZImUC1Nr/FPkAeZLanHvt56dwPd/rZoLd4JewEuZSIWr8dOSLVp4eOE9T/mxTT+uozTindHE1+UKlFKblsZl79AZHaVybIoUTqTLHnFGbFyd+9Zp8kG7rE56nYzfLTYWYjbtXatOBPFQyNXRc4ndpfmYxywO7Dn0JS6nSzY/WQIF1Mm+aUhm8aAl+3cypEdgNmdylIGFPadEuyNZ1Gzruze3oy1q43a9vyf+PMHeFJfXZbnr+GubUrnEPnWmwOa/3L5SsB9A2KSf1NPo/g/UFnl+bsAkz+H+/ZRLH0yFUu6Csh3HLvFItWXhGlM1blb/cP/Ve3zq3bTu33fRJEPJK+Bv/e7ZWIKuTyi0f+TDTWx0JtZ3nVvjwPn4cHyJZ1NtSIQ+/zuHv8E/LiPHk69J657DEX7hhEhGTpJLJUPh9oQLr9t6dWVBxLLelzqCRrGQm08LFkvLaYahlZtgndga9v4Gj9KoucB17b9rPMr4Fg084zYiVyInb+74wTgyy/pkoRXaIDWgvilcbnEIlXhjxEj5KTwtNJbJwETqPCcuVWmOixHNTjPJF1qsAa2g+5FcWsDNFSYG1aTJuwVGXDHdIYUHwUzzU2Vc5ydhG5/ONZ+TzkXo20ZwkgpgFhTtq08vmeLxU2jjWrruZ88Lk97z5/SH8lAtCl29l+1PvY0MI9fIUo5+caOXc9B2snlRkDTwl1Yd1bVrhZH6a/WH8mM/jH6wNuSGFpmtBnsK+yEFdA8x/oq2YodeJ2tK4iFuXWXYOMEw+gzhLHGVOtwG7b/F3G/OsiwsW2FqAm4cuJuxWAziegTglV9NGcZSzw0F2348mK/Td1sqh1iH2KFOK5cB/ZpfOM2cwR4IyfPeuXdjmJnTfLeORIqlUCk014D18avrOt2/fM+e36zjgSuF843Jt4yKTqLzfrmqi2acUUiHIav3j/xZpdz21p0qdsntF1t2fNTdh1ap1nPimXyofSnt2lp05pH8oDMM/vUX+nMaNBB078J3va3ypO7OT+MzOwPeZo8aB8hFLpQauvmMuf1b8YHcWG++j/TWH92BnAAFT+OZgQGf5CbLJTfcFUc+7VLPJ036mO1d62+tPUnXtM+evdNWrSzmLKpHmo4RxfoTCwfx5pmQmzSoAYeNRV6G7hiV+7rNgoa3F+2BAp0fnCeGsdxbw1BKckYGqUlaVrZeJBe7Eck9CEOYbnGsFkyuqzZH2/we+G64IS1yUV1kbOWJS143W3SYCs/FGdAYSYI0tq2jXszmfjfHp0qs+eeSXjilesnvw4FwHyWgyzqQ2ZYnTeCrn5v1dRjisbnAN3yU6/BAVMkNGX/M5ypfomG/IjY6RCPVXFez9dQ+Q+B8LsuQTtIFkW2TMuhln4s3wH86u6RU+GBe7XOa3UGLz2y/zJVwuQuw6wydQRykGzvlr6/nLr0WhRqoYzRYg5oGAdRMw6Kbm3RYr0rrGRU7y3rdx+d85GHT16DOwXtwlHLoEtRPDMsgzCc1qRSa5SZG4hwbtvZ3ajhQrFMbb9mAmJEb+kJWDHUxGtQSLrNRFD/NMkQl2keKehhbpf2pZYlSL+lYLcsYeoOndf+TuMw16FiyrZ9hmf1p0mt2X2J8OiOJRmDChmEcByDhDFVBjvnddGV9z57zzYrWex2b7cvSpCU6xxKo3lT8TuzUnJVXso5eW730ksSxCbjhd0scTdSmvMk37D7nJ+gyNbW73PoTS1L14mnCyNPJd8yP5z6jXie/H2qQDimRkffdysRDbpgN3swt3Ayty8kyasaGrAECzoS1Uzq7vpo4l06ctFWR/w0el0II0dFX/6xm8tP3P+m+rP9Np6ElwEW7Puxm49rCCvIFcPnE79862JsMQZl7H2GUh5DCAPSzZFEvIVuCfGW1/oYAGpvalTMS+Yji8v0759N/rGW71/3SNMcr7Rcdf/J5XZXOHFnKi3TL2/tgHBP1qXfzEvLrNDHXvcX8wTlch/KJOTupRvLeMxG3wPeu1MaoX+3aDr+B60vaSFflqn0J5sUF7Ejju+PkWe5Ruq5pxGr8/KB3qem98Sm0u7XWUuRhclvFPiwMPKFjnCcceD6oKSM0dMxjeI9IP2rkX9UvcpldiuvhtKeeWrvu6rAxv03mmvCZWMPRfRmjcduWYWtfrTIq9ePVcw3KdFKaIxiHJBcMwywcwmS8xhN8ka9wvziQ83ALDes9KxTqE6naqqnVhiOWRlkrH7zWxZspGrUoZ6Mxh6i4XPe7xDcMS4mqaB6YPmo/DVaEXf1tuZpJmAAFMOqjnwYaPN0+4kN0N5ZywydRonjIroOyt8uAl0PUGX3StRzncCZe0TlryOdQ4lY830X/xRDYtbyZJ7h0z6LZ2YwDZ7b/nB5Qhb7Xhm2UhmfyKcFrMAeU75iXSiuyn35WOwb6EBnKXCyRa3q5/39BcJblVmwlCDD3v8PuY1lKkg/AnWfQnxVRCkExGsNy1S5/GnyUi1cqDlEf5cxWIn3mA33EhC5K0YSHk30HRzmZ+wenfXamUwuOv79D6jxuo9IC5c8ADeuAzcGhPeKO5KDj6imX+rrWwcZIxhEcOF0WEOPxlZ5P2sNOe1wGqMTtMfdVJ0Kk+bSsNB4+M+qi9ZjLT4hcIqfP8OkPXEFXvA4T3Cy9pV9WJAXULE1Y+7hQr0iWVjatShpg15Ozcr9LzfG//IpBK9KL/5yg/wUHX7UBive7l5aLqBSuvqgKl7ye9PwMn2b8kazi2hRHk6Xp+P6EHrHww8OPqVftNi3IFqizasvNnoAgqg+cXxvZtbnDG7QEk3YhjUPbR5lAOev/NULbSw080PEZodlQHAo0+ynKPDAJDhT01I+w8KDfiAqegYanAeZTY9hBIjBSF62iW0+Kfw/0pwY0pfB/9BUo1a90B9/l38DyiGM1eaOH13f5SCZGH2zlAUw8bdReo9pZ/XBt6yPhNUSp2vljB5gg82//0gianVArokEc4GIXxCvP3dFElSRnJ+9vf+q/3h9SPLmebvjSmeVT7z67z5kPDK3C0w3BNq93IbBIKxlBgs1+0rER5iX8UKIGrCK6IP05P0T5HP9r8nl58DyYjJ1avBNtQu62oQhABw5c9RJi6gDD/5bRRUmjxoixAq6jXYSM6tRhww8+7PKk/AmnRqryQk+MeVNjjQm9fwu3Lev1ufWg/wuU+vn1illQGJ1tZJfOEKV6L5t9bn5G9fuyYpkDDZ+v6VCmlLFMn6S4FGnewHV2Et3ts8VCUjnWscVfNDmkKr0pzVr0is+xCf8ytXs8r4JnXGthkJT/NH4ukfBJyC9LG9boEFznbGqWIp7ApgjROjHG6npf4azONAqTT9Lne2UYC1fp577X3asM78HCz4DO4xI+FhV4WUdobK5U0qcP3nfGeJHbeuaDTfRzVjziyw256bl2dKvzJ3D324LxvjBYXaThHYLxNjWMelSxHf+HGk8qQAQGUi5I4wQKegXiqBamiHTw8PaVRjIsXT5HTbgtCp+G1+h2sjZJ3gm7fp5aUO8zy4LOFpqAOmQb6qlAL3+P2LDmxgHuDfeFiVHqSlX0vm8p2UOOXPWLCTGoCeIa6txCg+cKqWIzzVoFeMtnxzBO6hxgghBso2JsnhKf/vnqaxAuvQesf8OYx7Xx4yxTeaODy3n36XmoOG/GHGzke+i7OoESdykwyaiUSPIaoX6gicr2tTMq816lhyUqeRiTz4SkUKv247l0dM/SLL58gukH3kWYK2dDcwZyMcT+lHnsqOOXuBGGeITK+R5N9Oa/LZCfNaQjT1O32aVTJqk+eJqfYBjzXhVFdf5TgbGrls3GYBg+92bxMlPHNf/eBdJL/WCA24/hOxpflzGQ8rWKMET0l2LtOmeQ+g3NluuV4iHUH+mFxjLnBKQD9ZFSLYV8W/4eJ8v3yc9fZ7zr1c8aFkVuWnlQ96//2V1Pn1WwGqkAOsBF8v3EX26M5h+AlftJgnkYH6TgRq+zwk+yXAunIxqlUeqzMOhP0XvIx6FZblk5zoE5pPip865DeWZIe2MXlW0Tn7/YSA3UskY4GJup91P95/ZHyyqSj8/zzFtH6AdfoyzLY4WTBsgUTlvoDJnNnc3NOofGzojdmLb0jjK7EcOUoFGrXdwk0S7psM2OQgiwlnE/5XZDLu4b/c2ZpKxTtL2NCLv69nXEG14Ulmg/oAzzB0bOnDOOoZASjZ4aF2HIR2+79dmzOVUve3mWeBDWOSMRrH58vG75FSxcSarqznkZvvGUdwWMWqJdaScL3NWnBAu9QHxqFqTa/MWr++JPw/NNKPtkZwipY5+6hRepSFqoDZppGAZ15El6RNa8ZRQqeZiuqiMOe+O5pSlabPN5wvkytPB03EOlPi190ImHxZ4zfOqhfqANr3ErX9xD3i/7MVMhRw1DrVO4/dKEjLhozYFmHcVC6+pv2birQ4/cxb15mEqlSQd7dvXCYGrly5/I52allZiNvDvplrTAqJfJFKbkhX1ZzSCIr+IYd9YAz88u9H50Dl85tagiGsjJa3sJF53RCOQ4OlqT+V2nDvU5uCXEr8L0U64TfEUTdCjsiMHJpHG4uy8aZPbmIbgPNH5yUx1u8VBJ4eAqsjya9duIbj+NaK/fgZfCqRcV4xgPrHze/fvpv4e2dP6dP//C0ekp09qnkZo/oxxpQW89eT8naTl+bHvvz/1QMYi9G6GJ+v/r7M+Ix3n6A720D4xz4dNB89eGuB+R1785Mmg/pHNkBCuX2vu2f53GdygV7yT+frLZC9bADBxjvBsvccgZlsbK2H2eFA4HBQ6lMnQ+dlYJ1IlmbH7dtE66TEHi+AxKO9xDRnzl35iW5+1lvBu7f3Q8G6nNq6OCR05vvR5uZaRJ+2v+paiRyE6kobwW9ex7+AZP4oiXYJEPr6/YTcrDxXz96ge+ARcsxb8Uw3ajbGsYjuhlnlfccMX1zUqzeedVbP9plhrqA71rfi3lVOtNvMiXnnssSL/26awhCOYL1pZDk0P3nGyZtKsypvcJCRqyeJ0mHTbXv1HcvGZzmaaeq1awp/nqLtdL/CWbh0RkAC7+dlAr/lRVyohhrKv/CmXcM6R6p2ifdbHcxPg0YRN2xhxspGaaxNprwi+ByrmHhySPFGLlv2bstYPJRZufwqfBRrr9n9R2ihKoUlZofo/kdb5AKp/myJ8VynZ4/voQb5XZ5GIFWui11P1cOxczfqHOZ5Sv4SiVM//yFzAAgt6FprKb95xVcuCj9uA8GsvrD1xycY515qxSjxdFHUcZpEFyJCsd0QHLLU0Yz48bdGnCO7QGYeCJj8yh3hQvVdKsrJD79mFuowFqreEjz1NKrtLwDj71bw2V799Gkt9P4rofuoMDb9dTL3XEUWd+5qH56806LKHrPtzhQxJu17wN+vEf8ss0jN/5N5z/Y+q1WiIMR5cPXM5WKt6eMSBXJa1uimulYBzy2Bf3ldf1lRyhavFJ8PGdnAUxRuUwpCPPoJX+S3oY1gW9QTPQ9L5kATgRhTiZ9SPdVIeGJRkK/yRTgc0+SXtISNnO369Dl9UbR7C2BR91HKQiGYSCHQjJ7aJOL6cn6JNAcbA0avFV6aEguw/m7xseicPBMujFGqGuJzYOngJIstCfZvuK5NnfjWHszsMwLVekjC5hn/8S2STP6zfaI96pOP9WE7Q9o3pNTZ88OcrjaxhiWcPqBZ2s9TsH76NDdAWv2j18jxlIAbRQvaUY++iw3qX0i/ORH5MR/vJCPcUyHGMSQa57HC/gZa8tQ3gjWueyx+KKk0LjPOzK2MUhPapD+o3jYW3HkIdmzEqsznPVx+Cr5ZTeUVuGoniP6ghfpMn6qo0c35/40cD3BPZH/Gifz6gOy8WTqFWnbfdZ96MjEWJFr0soaC3iqH2oVSdkdBdS0nRwMqRhLy04I3xB82SkCu5idsQUrrOr86rFqnavsUa8C/Lg2LLPTz8nKuf8pwgCIwkm+cIpxRKfLc5o8K7P7n/7ujhjxpo/XMgFL+dtlAk8W6ZxaNk+Jj7/IJ+nNjR+vvyezRezmXq97+E6UrC9qXUX7P4vm/IsLIA8Oiw/uru93QB48Cnu0Y5kA6+ltm0WVXCY9F7tOUJ1RR8YkQQZXL3XLGmRMRvkRmznwRVnhwCuCB2X12hMSkN2Y6Neg1yrgxIo6BnWMW2JKmp95ucMR7HLkgBIlRFK4cFp4gas5OtyjzQDAxXxxZzyBE+hEapA3dXsLXJNXVj5tJ1eHAJjelEuIROXaLnOVgE1PaM4gHP0BgdRa45mYTSyPT/50f5FY+gl9g+LqRbm8zSTc/gvy/M38B+9T3xeA5j1X/88szmfJ/YOO3624+6jubXWY7+7UPw/kvuRFxt8qj7z5zTulJP2yfczp4o4Hqz1qzvq35O6isCeU69X/D4/DI4aH9cXJ2CVNksfHuKyM8O+clhK7PIewLtlCGt9BmFIOm1UW6QN7fhYGnyGbYIafK43duc/gnc7zcPGNhbf8G/cm3IdL+nN/KKlMgMOW6/dP9Ics5/SfVlZNexzBW9KLR4GAwt6KniQ+uAlHqVOCHZXMduTJw3q4Usn1XPzOPVll+itjY+y5Z8KkS9Gq3VJERXSEDTQqE9xZppRubSKj1758Q0D4rqaYoqHfquw1+5QE43nBFjjnje2YOunj4/5pcds1RGXp1h72eXfXDC4kjfSO4l7RzC3ctPvpVUfnUd4US9stTFueIbA4fauTvzO00FfRSP9ebGKxupe2noGHQ/HZk9vtAJr5upHHXqZrzPnuGChlz2BJzcVagKRaO+PbUt5x6HST50n2QQl+s38TuJGGCLP3aFT4svzw4WWJ3ppS7RpcyQ/8+MZcc2T9Mq5XL44l13IDh+GVBpVFQuMltPzVMQkDlmwXYpgDaI2SOXGbhS9OSCtcjdfxUH/yg03J2/ViWyWPBa5RyRQSzgXtdUsyWMXtP1nPO7m1GdMmumrK0t8r9mcxKnry9YO8aExHSUFrwPzaGLmsbEYi0tPLamMOlSFpX4PXefLMnG+Ht9fz00j2rAv8E27Ot+Ri1BqvVcJhVaifiXv1/4PDte3CewEwHEAAAAASUVORK5CYII="
;e.style.display="none";document.body.appendChild(e);return{setSize:function(i,s){e.width=i;e.height=s;t.fillStyle=t.createPattern(n,"repeat");t.fillRect(0,0,i,s);return r.needsUpdate=!0},texture:r,canvas:e}}();THREE.Vector3.prototype.makeParticle=function(){this.mass=1;this.massInv=1/this.mass;this.fixed=!1;this.old=this.clone();this.acc=new THREE.Vector3;this.vel=new THREE.Vector3;return this.tmp=new THREE.Vector3};THREE.Vector3.prototype.integrate=function(e){if(this.fixed)return;this.acc.multiplyScalar(this.massInv);this.vel.sub(this,this.old);this.vel.multiplyScalar(.8);this.acc.multiplyScalar(e);this.vel.addSelf(this.acc);this.tmp.add(this,this.vel);this.old.copy(this);this.copy(this.tmp);return this.acc.set(0,0,0)};Spring=function(){function e(e,t,n,r){this.p1=e!=null?e:new THREE.Vector3;this.p2=t!=null?t:new THREE.Vector3;this.restlength=n!=null?n:10;this.stiffness=r!=null?r:1;this.delta=new THREE.Vector3}e.prototype.update=function(){var e,t,n;this.delta.sub(this.p2,this.p1);t=this.delta.length()+1e-6;n=(t-this.restlength)/(t*(this.p1.massInv+this.p2.massInv))*this.stiffness;if(!this.p1.fixed){e=this.delta.clone();e.multiplyScalar(n*this.p1.massInv);this.p1.addSelf(e)}if(!this.p2.fixed){this.delta.multiplyScalar(-n*this.p2.massInv);return this.p2.addSelf(this.delta)}};return e}();Paper=function(e){function t(){t.__super__.constructor.apply(this,arguments);this.gravity=0;this.stiffness=.6;this.anchors=[];this.targetPosition=this.position.clone();this.material=new THREE.MeshPhongMaterial({shininess:500,ambient:3355443,color:13421772,specular:6710886,bumpMap:this.bump,perPixel:!1,wrapAround:!0,bumpScale:1.5,metal:!0,envMap:this.environment,reflectivity:1});this.material.side=THREE.DoubleSide;this.build()}__extends(t,e);t.prototype.cols=10;t.prototype.rows=10;t.prototype.bump=Bump.texture;t.prototype.environment=THREE.ImageUtils.loadTextureCube(["img/skybox/px.jpg","img/skybox/nx.jpg","img/skybox/py.jpg","img/skybox/ny.jpg","img/skybox/pz.jpg","img/skybox/nz.jpg"]);t.prototype.build=function(){var e,t,n;this.position.y=0;if(this.mesh!=null){this.remove(this.mesh);renderer.deallocateObject(this.mesh)}t=camera.fov*HALF_PI/180;e=tan(t)*(camera.position.z-this.position.z)*2;n=e*camera.aspect;this.geometry=new THREE.PlaneGeometry(n,e,this.cols,this.rows);this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.receiveShadow=!0;this.mesh.castShadow=!0;this.mesh.receiveShadow=!0;this.mesh.castShadow=!0;this.add(this.mesh);return this.initPhysics()};t.prototype.initPhysics=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;this.springs=[];u=this.geometry.vertices;s=this.geometry.faces;for(a=0,l=u.length;a<l;a++){o=u[a];o.z=random(40);o.makeParticle()}h=[];for(f=0,c=s.length;f<c;f++){i=s[f];e=u[i.a];t=u[i.b];n=u[i.c];r=u[i.d];this.springs.push(new Spring(e,r,e.distanceTo(r),this.stiffness));this.springs.push(new Spring(t,n,t.distanceTo(n),this.stiffness));this.springs.push(new Spring(e,t,e.distanceTo(t),this.stiffness));this.springs.push(new Spring(r,n,r.distanceTo(n),this.stiffness));this.springs.push(new Spring(e,n,e.distanceTo(n),this.stiffness));h.push(this.springs.push(new Spring(t,r,t.distanceTo(r),this.stiffness)))}return h};t.prototype.changePattern=function(){var e;Pattern.setSize(width,height);Bump.setSize(width,height);Pattern.draw();this.material.bumpScale=random(.5,2);this.material.reflectivity=random(.2,1);this.material.bump=new THREE.Texture(Bump.canvas);this.material.bump.needsUpdate=!0;Pattern.generation<2?e=Pattern.cloneCanvas():e=Pattern.canvas;this.material.map=new THREE.Texture(e);return this.material.map.needsUpdate=!0};t.prototype.moveTo=function(e){this.targetPosition.copy(e);return this.position.copy(e)};t.prototype.easeTo=function(e){return this.targetPosition.copy(e)};t.prototype.drop=function(){var e,t,n,r,i,s,o;e=new THREE.Vector3(random(-2e3,2e3),0,random(2e3));e.makeParticle();e.springs=[];o=this.geometry.vertices;for(i=0,s=o.length;i<s;i++){r=o[i];t=e.distanceTo(r)*random(.8,1);n=new Spring(e,r,t,.05);e.springs.push(n);this.springs.push(n)}return this.anchors.push(e)};t.prototype.update=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;h=this.anchors;for(i=0,a=h.length;i<a;i++){t=h[i];t.y-=500}this.position.z+=(this.targetPosition.z-this.position.z)*.2;p=this.geometry.vertices;for(s=0,f=p.length;s<f;s++){r=p[s];r.integrate(e)}d=this.springs;for(o=0,l=d.length;o<l;o++){n=d[o];n.update()}this.geometry.verticesNeedUpdate=!0;v=this.geometry.vertices;m=[];for(u=0,c=v.length;u<c;u++){r=v[u];m.push(r.z=max(-20,r.z))}return m};t.prototype.resize=function(){};t.prototype.destroy=function(){return this.springs=[]};return t}(THREE.Object3D);Scene=function(){function e(){this.scene=new THREE.Scene;this.mouse=new THREE.Vector3;this.delta=new THREE.Vector3;this.distance=0;this.dragging=!1;this.current=null;this.next=null;this.anchor=new THREE.Vector3;this.anchor.makeParticle();this.anchor.fixed=!0;this.springs=[];this.active=[];this.lights()}e.prototype.currentPosition=new THREE.Vector3(0,0,-100);e.prototype.nextPosition=new THREE.Vector3(0,0,-200);e.prototype.oldPosition=new THREE.Vector3(0,0,0);e.prototype.init=function(){var e;this.sheets=function(){var t,n;n=[];for(e=t=0;t<=5;e=++t)n.push(new Paper);return n}();this.pool=this.sheets.concat();this.next=this.pool.pop();this.next.moveTo(this.currentPosition);this.next.build();this.next.changePattern();this.active.push(this.next);return this.nextSheet()};e.prototype.lights=function(){this.ambient=new THREE.AmbientLight(16777215);this.spot=new THREE.SpotLight(16777215,2,0,PI,60);this.spot.position.set(500,3e3,2e3);this.spot.lookAt(new THREE.Vector3);this.spot.shadowMapHeight=1024;this.spot.shadowMapWidth=1024;this.spot.shadowDarkness=.25;this.spot.castShadow=!0;this.scene.add(this.ambient);return this.scene.add(this.spot)};e.prototype.nextSheet=function(){var e,t;(t=this.current)!=null&&t.easeTo(this.oldPosition);while(this.pool.length<2){e=this.active.shift();this.scene.remove(e);this.pool.unshift(e)}this.current=this.next;this.next=this.pool.pop();this.current.easeTo(this.currentPosition);this.next.moveTo(this.nextPosition);this.next.build();this.next.changePattern();this.scene.add(this.current);this.scene.add(this.next);this.active.push(this.next);return this.distance=0};e.prototype.startDrag=function(){var e,t,n,r,i,s,o,u=this;if(!this.current)return;this.dragging=!0;i=this.current.geometry.vertices.concat();i.sort(function(e,t){return e.distanceTo(u.anchor)-t.distanceTo(u.anchor)});e=floor(random(20,80));o=[];for(n=s=0;0<=e?s<=e:s>=e;n=0<=e?++s:--s){r=i[n];t=this.anchor.distanceTo(r);o.push(this.springs.push(new Spring(this.anchor,r,t*random(.8,.9),random(.4,.7))))}return o};e.prototype.stopDrag=function(){this.dragging=!1;this.springs=[];if(this.distance>800){this.current.drop();return this.nextSheet()}};e.prototype.update=function(e){var t,n,r,i,s,o,u,a,f;this.dragging&&(this.distance+=this.delta.length());this.delta.sub(this.mouse,this.anchor);this.delta.multiplyScalar(.08);this.anchor.addSelf(this.delta);u=this.active;for(r=0,s=u.length;r<s;r++){t=u[r];t.update(e)}a=this.springs;f=[];for(i=0,o=a.length;i<o;i++){n=a[i];f.push(n.update(e))}return f};e.prototype.resize=function(){var e,t,n,r,i;r=this.sheets;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];i.push(e.resize())}return i};return e}();width=window.innerWidth;height=window.innerHeight;aspect=width/height;distance=1200;renderer=new THREE.WebGLRenderer({antialias:!0});camera=new THREE.PerspectiveCamera(75,aspect,1,1e4);scene=new Scene;clock=+(new Date);drag=new THREE.Vector3;init=function(){renderer.shadowMapEnabled=!0;renderer.shadowMapSoft=!0;renderer.shadowMapCascade=!0;renderer.setClearColor(1118481);renderer.gammaInput=!0;renderer.gammaOutput=!0;camera.position.z=distance;document.body.appendChild(renderer.domElement);window.addEventListener("mousedown",mousedown);window.addEventListener("mousemove",mousemove);window.addEventListener("mouseup",mouseup);window.addEventListener("resize",resize);scene.init();resize();return update()};update=function(){var e,t,n;n=+(new Date);e=n-clock;t=e*e;clock=n;scene.update(t);renderer.render(scene.scene,camera);return requestAnimationFrame(update)};mousedown=function(e){renderer.domElement.className="grabbing";drag=scene.mouse.clone();return this.scene.startDrag()};mouseup=function(e){renderer.domElement.className="";return this.scene.stopDrag()};mousemove=function(e){var t;scene.mouse.x=1.5*(width*-0.5+e.pageX);scene.mouse.y=1.5*(height*.5-e.pageY);if(scene.dragging){distance=drag.distanceTo(scene.mouse);t=sqrt(width*width+height*height);return scene.mouse.z=300*(distance/t)}};resize=function(){width=window.innerWidth;height=window.innerHeight;renderer.setSize(width,height);camera.aspect=width/height;camera.updateProjectionMatrix();return scene.resize()};init();